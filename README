# docker
yum install -y yum-utils device-mapper-persistent-data lvm2
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
sudo yum -y install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
systemctl start docker 
systemctl enable docker 
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://registry.cn-hangzhou.aliyuncs.com",
  "https://docker.m.daocloud.io",
  "https://docker.1ms.run"
  ],
  "exec-opts": ["native.cgroupdriver=systemd"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
cat  /etc/docker/daemon.json
docker info



# 初始环境
git clone https://github.com/hezhengyue/face_sys.git
cd face_sys
docker compose up -d --build
docker compose ps
docker compose exec web python manage.py makemigrations
docker compose exec web python manage.py migrate
docker compose exec web python manage.py collectstatic --noinput
docker compose exec web python manage.py createsuperuser

docker compose restart web
docker compose exec web python manage.py migrate






# Firewalld
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload


# 用户锁定处理
# 解锁所有
python manage.py axes_reset
# 解锁单用户
python manage.py axes_reset_username <用户名>
# 手动解锁
'''进入后台首页，找到Access attempts,找到对应用户名/IP 的最近失败记录,删除这些记录。
原理：Axes 是通过计算数据库里的失败尝试记录来判断是否锁定的。把失败记录删掉，计数归零，自然就解锁了。'''


# django-simpleui静态文件克隆
python3 manage.py collectstatic

